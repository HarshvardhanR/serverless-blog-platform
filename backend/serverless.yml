service: blog-platform

provider:
  name: aws
  runtime: nodejs18.x
  region: ca-central-1
  environment:
    USER_TABLE: ${env:USER_TABLE}
    POST_TABLE: ${env:POST_TABLE}
    COMMENT_TABLE: ${env:COMMENT_TABLE}
    JWT_SECRET: ${env:JWT_SECRET}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - dynamodb:GetItem
            - dynamodb:PutItem
            - dynamodb:UpdateItem
            - dynamodb:DeleteItem
            - dynamodb:Query
            - dynamodb:Scan
          Resource:
            - arn:aws:dynamodb:ca-central-1:*:table/${env:USER_TABLE}
            - arn:aws:dynamodb:ca-central-1:*:table/${env:POST_TABLE}
            - arn:aws:dynamodb:ca-central-1:*:table/${env:COMMENT_TABLE}
            - arn:aws:dynamodb:ca-central-1:*:table/${env:USER_TABLE}/index/*
            - arn:aws:dynamodb:ca-central-1:*:table/${env:POST_TABLE}/index/*
            - arn:aws:dynamodb:ca-central-1:*:table/${env:COMMENT_TABLE}/index/*

functions:
  register:
    handler: auth.register
    events:
      - httpApi:
          path: /auth/register
          method: post

  login:
    handler: auth.login
    events:
      - httpApi:
          path: /auth/login
          method: post

  createPost:
    handler: posts.createPost
    events:
      - httpApi:
          path: /posts
          method: post

  createComment:
    handler: comments.createComment
    events:
      - httpApi:
          path: /comments
          method: post

plugins:
  - serverless-dotenv-plugin

custom:
  dotenv:
    path: .env
